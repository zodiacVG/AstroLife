# Todo

## 已完成 ✅
- [x] 搜集数据库
  - [x] 建立航天器基础数据库 (starships.json - 整合了astro_facts_data.json和astro_oracle_data.json)  
  - [x] 包含中英文名称和完整档案
- [x] 设计产品文档
  - [x] 完成核心PRD文档 (PRD_Complete.md)
  - [x] 详细数据流架构设计
  - [x] 技术架构需求分析

## 待完成 📋
- [x] 设计前后端架构
  - [x] API接口设计
  - [x] 数据库优化方案
  - [x] 缓存策略设计
- [x] 开发
  - [ ] 核心算法实现
  - [x] 前端界面开发
  - [x] 测试与优化

## 当前已完成 ✅
- [x] 前后端CORS配置修复
- [x] 前端开发服务器配置
- [x] 后端API服务器配置
- [x] 前端页面组件开发
  - [x] 首页 (HomePage)
  - [x] 占卜页面 (CalculatePage) 
  - [x] 航天器档案页面 (StarshipsPage)
- [x] 后端API接口实现
  - [x] 根路径健康检查
  - [x] 航天器数据获取
  - [x] 占卜计算接口（算法已实现）
- [x] 核心占卜算法开发
  - [x] 命运航天器匹配（基于出生日期）- 数字计算方式
  - [x] 时运航天器匹配（基于当前日期）- 数字计算方式
  - [x] 问题航天器匹配（基于关键词）- 数字计算方式
  - [x] 神谕解读生成 - 基于预定义文本

待办：
- [x] 修复数据文件路径问题（后端算法模块）
- [x] 修复datetime模块导入问题（后端主模块）
- [x] API接口调试完成（后端服务正常运行）
- [ ] 优化前端界面样式  参考设计规范 v1
- [ ] 添加错误处理和加载状态
- [ ] 完善API文档
- [ ] 算法性能优化
- [ ] 添加单元测试
- [x] LLM大模型集成计划
   - [x] 问题航天器匹配改用大模型智能选择（替代关键词匹配）
   - [x] 神域大模型最终解读生成（整合三艘宇宙飞船结果）
   - [x] 阿里云百炼模型API集成
   - [x] 大模型提示词工程优化
   - [x] 修复API调用方式（已改用OpenAI兼容模式）
   - [x] 修复API密钥验证问题（账户已充值，API密钥恢复有效）
- [x] 完善前端界面显示逻辑（三个星舟板块和神谕解读显示）
- [ ok] 前端无法显示三个星舟的匹配
- [ ok] 前端无法显示最终结果，没有相关界面设计
- [ ] 寻找飞行器图片，加入到数据库

UI
精密细致的风格，紧凑
更符合风格的中文字体
左对齐
闪动光标
控制台常见标识
反色标题文字和矩形底框
动效

bug：在预测页，点到详情页之后再返回，没有保存状态
bug：现在间隔还是很大
优化：出生日期和问题都要放到 INPUT一个大框里面，就像是一个终端界面中一样
优化：首页按钮现在还是老样式
bug：很多按钮都没有显示出来，例如选择生日和开始计算的按钮
在标题下面加入关注坐作者文字和按钮，保持风格一致和克制：小红书  Zodiac https://xhslink.com/m/9Vmo5NJsG9L  关注作者解锁无限次数


改为真流式输出
优化所有按钮/超链接的样式，现在大多数按钮和超链接颜色很诡异，而且最后的计算按钮还是看不见
优化中文字体，特备是和英文混排时候的字号，现在中文字体太大了，可以考虑引入点阵中文字体
为了国际化和高级感，有中文的地方一定要有英文，但是现在只有英文的部分不加中文

简化标题区域，只保留版本，关注作者（这部分也要简化）
在现在的标题区和内容区之间加一些全局按钮，提供回到按钮，查看历史记录等功能。
我的意思是，有英文的地方不一定有英文，但是有中文的地方一定要有英文呢。你现在在很多 welcome之类的地方也加了中文，low 了。
流式改造失败了，输出的速度还是很慢，这科学吗

首页简化，去掉控制台文字
将所有介绍的文字都放在一个框里面
将开始占卜的按钮放在下面，查看所有航天器在下一行，视觉权重稍微小一些。



待办：

历史记录
双语
日志
次数限制系统，我可以后台配置


## 计算机制说明

### 当前实现（第一阶段）
目前系统采用纯数字计算方式实现三艘宇宙飞船的匹配：

1. **命运航天器** - 基于出生日期与航天器发射日期的天数差计算
2. **时运航天器** - 基于当前日期与航天器发射日期的天数差计算  
3. **问题航天器** - 基于问题关键词与航天器关键词的相似度计算（临时实现）
4. **神谕解读** - 基于预定义的航天器神谕文本组合生成

**注意**：问题航天器的关键词相似度计算是临时实现，正确的方式应该是通过LLM大模型智能选择匹配的航天器。

### LLM集成计划（第二阶段）
后续将集成大模型能力：
- **问题航天器匹配** - 改用大模型智能选择（让大模型根据问题内容决定匹配哪个航天器，替代当前的关键词相似度计算）
- **神域大模型最终解读** - 整合三艘宇宙飞船的结果，生成最终的智能解读
- 阿里云百炼模型API集成
- 大模型提示词工程优化

## 数据准备清单
### 数据完整性 ✅
- [x] 历史航天器档案（可扩展）
- [x] 中英文双语名称
- [x] 发射日期、任务类型、状态
- [x] 历史影响和技术意义
- [x] 象征关键词和神谕文本
- [x] 核心原则和旅程阶段分类

### 数据验证需求
- [x] 修正匹配逻辑：使用LLM直接选择而非向量匹配
- [x] 修正日期匹配：直接日期差值计算匹配 (非LLM驱动)
- [x] 补充完整LLM提示词：包含三体选择和最终解读
- [x] 日期格式统一验证
- [x] ID一致性检查
- [x] 关键词完整性审核
- [x] 测试数据匹配准确性
- [x] 清理oracle数据冗余字段 (core_principle & journey_phase 合并到 symbolic_keywords)

## 系统架构
- [x] 创建monorepo统一架构
- [x] 建立AI开发指导规则
- [x] 创建共享类型定义
- [x] 配置VS Code工作区
- [x] 创建Zeabur部署文档

## 数据结构 [已完成]
- [x] 优化航天器事实数据格式
- [x] 简化字段结构
- [x] 统一状态值格式
- [x] 修复JSON格式错误
- [x] 更新数据结构文档

## 文档更新 [已完成]
- [x] 更新monorepo结构文档
- [x] 创建Zeabur部署指南
- [x] 更新数据结构文档
- [x] 移除探索性描述

## 新增明确需求 ✅
- [x] 取消向量匹配，改用LLM智能选择
- [x] 取消周年匹配，改用直接日期匹配
- [x] 补充三体选择专用LLM提示词
- [x] 补充最终解读专用LLM提示词
- [x] 明确LLM在数据流中的三个关键节点



