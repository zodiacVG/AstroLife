# 🤖 AI开发指导规则 - AstroLife项目

## 📋 全局行动准则

### 1️⃣ 每次行动前必须检查
- [ ] 查看当前文件上下文（如果有用户选中内容）
- [ ] 检查项目根目录的`.ai-rules.md`（本文件）
- [ ] 确认当前工作目录为项目根目录：`/Users/zodiacmac/Development/AstroLife`
- [ ] 检查`docs/todo.md`了解当前任务状态

### 2️⃣ 项目结构速查表

#### 📁 核心目录结构
```
AstroLife/
├── frontend/           # React前端
│   ├── src/
│   │   ├── components/ # React组件
│   │   ├── pages/      # 页面路由
│   │   └── utils/      # 前端工具函数
│   └── package.json    # 前端依赖
├── backend/            # FastAPI后端
│   ├── app/
│   │   ├── api/        # API路由
│   │   ├── models/     # 数据模型
│   │   └── services/   # 业务逻辑
│   └── requirements.txt # Python依赖
├── shared/             # 共享资源
│   ├── astro_data/     # 航天器数据
│   ├── types/          # TypeScript类型定义
│   ├── constants/      # 共享常量
│   └── utils/          # 共享工具函数
├── docs/               # 项目文档
└── .vscode/            # IDE配置
```

#### 🔍 关键文件索引
- **数据文件**：`shared/astro_data/starships.json` (整合了astro_oracle_data.json和astro_facts_data.json)
- **需求文档**：`docs/PRD.md`
- **任务清单**：`docs/todo.md`
- **项目说明**：`README.md`

### 3️⃣ 开发工作流程

#### 🎯 开始新功能开发
1. **检查任务状态**：`docs/todo.md`
2. **确认技术栈**：前端React+TypeScript，后端FastAPI
3. **数据修改前**：备份`shared/astro_data/`下的JSON文件
4. **API变更时**：同步更新前端类型定义

#### 🔧 代码修改规范
- **前端修改**：必须更新`frontend/src/types/`中的接口定义
- **后端修改**：必须更新`backend/app/models/`中的Pydantic模型
- **共享类型**：必须放在`shared/types/`中，前后端共用
- **常量定义**：统一放在`shared/constants/`中

### 4️⃣ 数据操作规则（灵活版本）

#### 📊 航天器数据处理
- **原始数据**：`shared/astro_data/starships.json`
- **备份规则**：修改前自动创建`*.backup.json`
- **字段规范**：JSON格式保持灵活，不强制字段约束
- **类型安全**：使用`[key: string]: any`支持任意字段

#### 🗂️ 数据灵活性原则
- **字段自由**：不限制字段名称和类型
- **结构开放**：支持嵌套对象和数组
- **向后兼容**：新字段不影响旧代码
- **动态处理**：运行时验证必要字段

### 5️⃣ AI行动记录要求

#### 📝 每次操作必须记录
1. **操作类型**：创建/修改/删除/重命名
2. **影响范围**：前端/后端/共享/文档
3. **文件变更**：列出所有修改的文件
4. **测试验证**：如何验证修改正确性

#### 📋 记录模板
```markdown
**操作记录**:
- **类型**: [创建|修改|删除|重命名]
- **范围**: [前端|后端|共享|文档]
- **文件**: [具体文件路径]
- **验证**: [如何测试]
- **影响**: [是否影响其他模块]
```

### 6️⃣ 技术栈确认

#### 💻 前端技术栈
- **框架**: React 18 + TypeScript
- **构建**: Vite
- **样式**: Tailwind CSS
- **状态**: Zustand
- **路由**: React Router
- **HTTP**: Axios

#### 🐍 后端技术栈
- **框架**: FastAPI (Python)
- **数据库**: SQLite (开发) / PostgreSQL (生产)
- **ORM**: SQLAlchemy
- **验证**: Pydantic
- **AI**: OpenAI GPT-4
- **部署**: Uvicorn

### 7️⃣ 快速命令参考

#### 🚀 开发启动
```bash
# 安装所有依赖
npm run install:all

# 启动开发环境
npm run dev
# 自动启动：前端5173 + 后端8000

# 单独启动
npm run dev:frontend    # 仅前端
npm run dev:backend     # 仅后端
```

#### 🧪 测试验证
```bash
npm run validate-data   # 验证数据完整性
npm run type-check      # TypeScript检查
npm run lint           # 代码规范检查
```

### 8️⃣ 边界条件处理

#### ⚠️ 特别注意
- **日期处理**：统一使用ISO格式`YYYY-MM-DD`
- **时区问题**：所有时间使用UTC+8（中国时间）
- **空值处理**：使用`null`而非`undefined`
- **错误处理**：必须返回标准错误格式
- **文件路径**：使用绝对路径，避免相对路径问题

#### 🔄 兼容性检查
- **浏览器支持**: Chrome 90+, Firefox 88+, Safari 14+
- **Python版本**: 3.8+
- **Node版本**: 16+

### 9️⃣ 紧急回滚

#### 🚨 快速回滚命令
```bash
# 回滚数据文件
git checkout HEAD~1 -- shared/astro_data/

# 回滚特定文件
git checkout HEAD~1 -- [文件路径]

# 查看历史修改
git log --oneline -10
```

### 🔟 AI助手自检清单

#### ✅ 每次回复前确认
- [ ] 是否引用了正确的项目路径
- [ ] 是否检查了相关文件是否存在
- [ ] 是否考虑了前后端同步
- [ ] 是否记录了操作日志
- [ ] 是否提供了验证方法

#### 🎯 最佳实践
- **渐进式修改**：小步快跑，避免大规模重构
- **即时验证**：每次修改后立即测试
- **文档同步**：代码变更同步更新文档
- **备份优先**：重要操作前先备份

---

**最后更新**: 2024年项目初始化
**维护者**: AI助手必须遵循此规则
**验证命令**: `ls -la`确认当前目录正确